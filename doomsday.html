<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grok梦工厂 - 末日生存模拟器 ☢️</title>
    <style>
        /* 末日废土主题，自适应 */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Arial Black', sans-serif;
            background: linear-gradient(45deg, #2c3e50, #4a0000, #1a0000);
            color: #ff4444; min-height: 100vh; overflow: hidden;
            animation: bgPulse 20s infinite alternate;
        }
        @keyframes bgPulse { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }
        .container { max-width: 1100px; margin: 0 auto; padding: 20px; text-align: center; }
        h1 { font-size: 3em; text-shadow: 0 0 30px #ff0000; margin: 20px 0; animation: glow 1.5s infinite; }
        @keyframes glow { 0%,100%{text-shadow:0 0 30px #ff0000;} 50%{text-shadow:0 0 60px #ff8800;} }
        .back { position: absolute; top: 20px; left: 20px; color: #ff6666; font-size: 1.2em; text-decoration: none; z-index: 10; }
        .back:hover { text-shadow: 0 0 20px #ffff00; }
        #battlefield { width: 100%; max-width: 700px; height: 400px; border: 6px solid #ff0000; border-radius: 20px; 
                       box-shadow: 0 20px 60px rgba(255,0,0,0.7); margin: 30px auto; cursor: crosshair; background: #111; }
        .resources { display: flex; justify-content: center; gap: 20px; margin: 20px 0; flex-wrap: wrap; }
        .res { background: rgba(255,0,0,0.3); padding: 15px 30px; border-radius: 50px; font-size: 1.3em; 
               border: 2px solid #ff6666; box-shadow: 0 10px 30px rgba(0,0,0,0.5); min-width: 150px; }
        .res span { color: #ffff00; font-weight: bold; }
        button { padding: 18px 35px; font-size: 1.4em; background: linear-gradient(45deg, #ff0000, #ff8800);
                 border: none; border-radius: 50px; color: #000; cursor: pointer; margin: 10px;
                 transition: all 0.3s; box-shadow: 0 10px 30px rgba(255,0,0,0.6); }
        button:hover { transform: scale(1.1) rotate(-3deg); box-shadow: 0 20px 50px rgba(255,136,0,0.9); }
        button:active { animation: explode 0.4s; }
        @keyframes explode { 0%,100%{transform:scale(1.1);} 50%{transform:scale(0.9);} }
        #commandInput { width: 70%; padding: 15px; font-size: 1.3em; border: 3px solid #ff6666; border-radius: 50px; 
                        background: rgba(0,0,0,0.5); color: #fff; margin: 20px 0; }
        #commandInput::placeholder { color: #ffaaaa; }
        #log { height: 180px; overflow-y: auto; background: rgba(0,0,0,0.7); border-radius: 20px; padding: 15px; 
               margin: 20px 0; text-align: left; font-size: 1.2em; border: 2px solid #ff0000; }
        .particles { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 100; }
        .particle { position: absolute; width: 8px; height: 8px; background: #ff0000; border-radius: 50%; 
                    animation: fire 1.5s forwards; }
        @keyframes fire { to { opacity: 0; transform: translateY(-100vh) scale(0) rotate(720deg); } }
        footer { margin-top: 40px; font-size: 1.1em; opacity: 0.8; color: #ff6666; }
        .gameover { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); 
                    display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 1000; }
        .gameover h2 { font-size: 4em; color: #ff0000; text-shadow: 0 0 40px #ffff00; }
        @media (max-width: 600px) { h1 { font-size: 2.2em; } #commandInput { width: 90%; } .resources { flex-direction: column; } }
    </style>
</head>
<body>
    <a href="index.html" class="back">← 返回梦工厂</a>
    <div class="container">
        <h1>☢️ Grok末日生存模拟器</h1>
        <p style="font-size:1.5em; margin-bottom:30px;">僵尸来袭！管理资源，指挥AI队友！输入指令：搜刮/防御/研究</p>
        
        <div class="resources">
            <div class="res">🍞 食物: <span id="food">50</span></div>
            <div class="res">💧 水: <span id="water">50</span></div>
            <div class="res">🔫 弹药: <span id="ammo">30</span></div>
            <div class="res">🏠 庇护: <span id="shelter">100</span></div>
            <div class="res">☀️ 天数: <span id="days">1</span></div>
        </div>
        
        <canvas id="battlefield" width="700" height="400"></canvas>
        
        <input type="text" id="commandInput" placeholder="指令Grok: 搜刮食物 / 防御僵尸 / 研究疫苗" onkeypress="if(event.key==='Enter') command()">
        <button onclick="command()">📡 发送指令</button>
        <button onclick="restart()">🔄 重开末日</button>
        
        <div id="log"></div>
        
        <footer>© 2025 Grok梦工厂 | <a href="https://grokdream.fun" style="color:#ff6666;">grokdream.fun</a> | 生存至第 <span id="record">0</span> 天！</footer>
    </div>
    
    <div class="particles" id="particles"></div>
    
    <div id="gameover" class="gameover">
        <h2>☠️ 末日终结</h2>
        <p id="deathReason" style="font-size:1.8em; margin:20px;"></p>
        <p style="font-size:1.5em;">你生存了 <span id="finalDays">0</span> 天！</p>
        <button onclick="restart()" style="margin-top:30px;">🔄 再来一次</button>
        <button onclick="shareReport()" style="margin-top:10px;">📱 分享报告</button>
    </div>

    <script>
        /* JS核心：实时资源 + AI指令 + Canvas战场 + 存档 + 粒子火焰 */
        const canvas = document.getElementById('battlefield');
        const ctx = canvas.getContext('2d');
        const particlesDiv = document.getElementById('particles');
        
        let resources = { food: 50, water: 50, ammo: 30, shelter: 100, days: 1 };
        let zombies = [], bullets = [], explosions = [];
        let gameActive = true;
        let record = localStorage.getItem('doomsdayRecord') || 0;
        document.getElementById('record').textContent = record;
        
        /* 事件类型 */
        const events = ['🧟 僵尸浪潮！', '☢️ 辐射风暴！', '👽 外星飞船！', '🌪️ 沙尘暴！'];
        
        /* 加载存档 */
        function loadGame() {
            const saved = localStorage.getItem('doomsday');
            if (saved) resources = JSON.parse(saved);
            updateResources();
            startWave();
            animate();
            setInterval(tick, 1000);
        }
        function saveGame() { localStorage.setItem('doomsday', JSON.stringify(resources)); }
        
        /* 每秒tick */
        function tick() {
            if (!gameActive) return;
            resources.food = Math.max(0, resources.food - 1);
            resources.water = Math.max(0, resources.water - 1);
            resources.shelter = Math.max(0, resources.shelter - 0.5);
            updateResources();
            checkGameOver();
            saveGame();
        }
        
        /* 更新资源显示 */
        function updateResources() {
            document.getElementById('food').textContent = Math.floor(resources.food);
            document.getElementById('water').textContent = Math.floor(resources.water);
            document.getElementById('ammo').textContent = resources.ammo;
            document.getElementById('shelter').textContent = Math.floor(resources.shelter);
            document.getElementById('days').textContent = resources.days;
        }
        
        /* 指令系统 */
        function command() {
            const input = document.getElementById('commandInput').value.trim().toLowerCase();
            if (!input) return;
            addLog('你', `指令: ${input}`);
            const response = aiResponse(input);
            setTimeout(() => addLog('Grok AI', response), 600);
            document.getElementById('commandInput').value = '';
            createParticles(20);
        }
        
        function aiResponse(cmd) {
            if (cmd.includes('搜刮') || cmd.includes('食物')) {
                const gain = Math.floor(Math.random()*20 + 10);
                resources.food += gain;
                return `✅ 搜刮成功！+${gain}食物（风险：僵尸靠近）`;
            }
            if (cmd.includes('防御') || cmd.includes('僵尸')) {
                if (resources.ammo >= 5) {
                    resources.ammo -= 5;
                    spawnBullet();
                    return `🔫 开火！击退僵尸（-5弹药）`;
                } else return `❌ 弹药不足！快搜刮！`;
            }
            if (cmd.includes('研究') || cmd.includes('疫苗')) {
                if (resources.food >= 10 && resources.water >= 10) {
                    resources.food -= 10; resources.water -= 10;
                    if (Math.random() < 0.3) return `🎉 疫苗成功！僵尸减少！`;
                    else return `⚗️ 研究失败...资源浪费`;
                } else return `❌ 资源不足研究！`;
            }
            return `🤖 收到！执行中...（输入：搜刮食物 / 防御僵尸 / 研究疫苗）`;
        }
        
        /* 僵尸浪潮 */
        function startWave() {
            if (Math.random() < 0.7) {
                const count = Math.floor(Math.random()*5 + 3);
                for (let i = 0; i < count; i++) {
                    zombies.push({
                        x: Math.random()*700, y: -50,
                        speed: Math.random()*2 + 1,
                        hp: 3
                    });
                }
                addLog('系统', `${randomPick(events)} 来袭！`);
            }
        }
        
        /* Canvas动画 */
        function animate() {
            ctx.clearRect(0, 0, 700, 400);
            
            // 背景废墟
            ctx.fillStyle = '#333'; ctx.fillRect(0, 0, 700, 400);
            
            // 僵尸
            zombies.forEach((z, i) => {
                z.y += z.speed;
                ctx.fillStyle = '#00ff00'; ctx.beginPath(); ctx.arc(z.x, z.y, 20, 0, Math.PI*2); ctx.fill();
                if (z.y > 400) { resources.shelter -= 10; zombies.splice(i,1); }
            });
            
            // 子弹
            bullets.forEach((b, i) => {
                b.y -= 10;
                ctx.fillStyle = '#ffff00'; ctx.fillRect(b.x-2, b.y, 4, 20);
                if (b.y < 0) bullets.splice(i,1);
            });
            
            // 爆炸
            explosions.forEach((e, i) => {
                e.radius += 3; e.alpha -= 0.05;
                ctx.strokeStyle = `rgba(255,100,0,${e.alpha})`; ctx.lineWidth = 5;
                ctx.beginPath(); ctx.arc(e.x, e.y, e.radius, 0, Math.PI*2); ctx.stroke();
                if (e.alpha <= 0) explosions.splice(i,1);
            });
            
            requestAnimationFrame(animate);
        }
        
        function spawnBullet() {
            bullets.push({ x: 350, y: 350 });
            createExplosion(350, 300);
        }
        
        function createExplosion(x, y) {
            explosions.push({ x, y, radius: 10, alpha: 1 });
            createParticles(30);
        }
        
        /* 日志 */
        function addLog(sender, msg) {
            const log = document.getElementById('log');
            const div = document.createElement('div');
            div.innerHTML = `<b>${sender}:</b> ${msg}`;
            div.style.margin = '6px 0'; div.style.color = sender === '系统' ? '#ff0000' : '#ffff00';
            log.appendChild(div);
            log.scrollTop = log.scrollHeight;
        }
        
        /* 游戏结束 */
        function checkGameOver() {
            if (resources.food <= 0 || resources.water <= 0 || resources.shelter <= 0) {
                gameActive = false;
                const reason = resources.food <= 0 ? '饥饿' : resources.water <= 0 ? '缺水' : '庇护崩溃';
                document.getElementById('deathReason').textContent = `💀 你死于 ${reason}！`;
                document.getElementById('finalDays').textContent = resources.days;
                document.getElementById('gameover').style.display = 'flex';
                if (resources.days > record) {
                    record = resources.days;
                    localStorage.setItem('doomsdayRecord', record);
                    document.getElementById('record').textContent = record;
                }
            }
            if (Math.random() < 0.02) resources.days++;
        }
        
        function restart() {
            resources = { food: 50, water: 50, ammo: 30, shelter: 100, days: 1 };
            zombies = []; bullets = []; explosions = [];
            gameActive = true;
            document.getElementById('gameover').style.display = 'none';
            document.getElementById('log').innerHTML = '';
            updateResources();
            saveGame();
            addLog('系统', '🌅 新末日开始！输入指令生存！');
        }
        
        function shareReport() {
            const text = `☢️ 我在Grok末日模拟器活了${resources.days}天！死于${document.getElementById('deathReason').textContent.replace('💀 你死于 ','').replace('！','')}！来挑战！grokdream.fun/doomsday.html`;
            navigator.clipboard.writeText(text).then(() => alert('已复制！贴微信炫耀😂'));
        }
        
        /* 粒子火焰 */
        function createParticles(count) {
            for (let i = 0; i < count; i++) {
                const p = document.createElement('div'); p.className = 'particle';
                p.style.left = Math.random() * 100 + 'vw';
                p.style.top = '100vh';
                p.style.animationDelay = Math.random() * 0.5 + 's';
                particlesDiv.appendChild(p);
                setTimeout(() => p.remove(), 1500);
            }
        }
        
        function randomPick(arr) { return arr[Math.floor(Math.random() * arr.length)]; }
        
        /* 初始化 */
        loadGame();
        setInterval(startWave, 8000);
        setInterval(() => createParticles(5), 1000);
    </script>
</body>
</html>